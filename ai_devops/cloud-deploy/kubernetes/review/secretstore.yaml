apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: $KUBE_NAMESPACE-secret-$CI_COMMIT_REF_SLUG
  labels:
    # Standard labels - follow these patterns, additional labels can be added if needed
    environment: $DOPPLER_ENVIRONMENT                  # This is our standard, do not change (output pulled from doppler will be either dev_,dev,stg,or prd)
    gitlab_project: $CI_PROJECT_NAME                   # This is our standard, do not change
    gitlab_pipeline_id: "$CI_PIPELINE_ID"              # This is our standard, do not change
    project_owner: web                                 # Select only from one of the following (web, api, sre, data, or rock)
# Do not change, this is what allows the external-secrets operator to authenticate to doppler
spec:
  provider:
    doppler:
      auth:
        secretRef:
          dopplerToken:
            key: dopplerToken
            name: doppler-token-auth-api
            namespace: external-secrets
      config: $DOPPLER_CONFIG
      project: $DOPPLER_PROJECT